#!/usr/bin/env node

const path = require('path')
const program = require('commander')
const relative = require('../lib/relative')
const opt = require('../config/option')

program
  .command('init <模板名称> [项目名称]')
  .description('指定一个模板，用其初始化一个项目')
  .option('-t --type <type>', '指定项目类型', /^(?:html|wap)$/i, 'html')
  .option('-w --weixin', '使用微信')
  .option('-c, --clone', '使用git clone')
  .action(require('../command/init'))
  .on('--help', function () {
    console.log()
    console.log('  示例:')
    console.log()
    console.log('    $ talk init static demo')
    console.log('    $ talk init vue demo')
    console.log()
  })

program
  .command('start [project]')
  .description('开发一个项目')
  .option('-o --open', '打开浏览器')
  .option('-p --proxy', '开启联调模式')
  .action((project, option) => {
    opt.set(option)
    require('../command/start')(
      path.basename(project && project !== '.' ? project : relative.PATH_CWD),
      option
    )
  })

program
  .command('build [project]')
  .description('打包一个项目')
  .action(require('../command/build'))

program
  .command('*', { isDefault: true })
  .action(() => {
    program.help(txt => txt)
  })

program.parse(process.argv)
